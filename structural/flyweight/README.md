# 享元模式

假设目前有 5 名恐怖分子和 5 名反恐精英， 一共是 10 名玩家。 那么关于服装， 我们就有两个选项了。

1. 10 个玩家对象各自创建不同的服装对象， 并将其嵌入。 总共会创建 10 个服装对象；

2. 我们创建两个服装对象：

- 单一恐怖分子服装对象： 其将在 5 名恐怖分子之间共享；
- 单一反恐精英服装对象： 其将在 5 名反恐精英之间共享。

方法 1 中我们总共创建了 10 个服装对象； 方法 2 中则只有 2 个服装对象。 第二种方法， 就是我们所遵循的享元设计模式。 我们所创建的 2 个服装对象被称为是享元对象。

享元模式（Flyweight Pattern）会从对象中提取出公共部分并创建享元对象。 这些享元对象 （服装） 随后可在多个对象 （玩家） 中分享。 这极大地减少了服装对象的数量， 更棒的是即便你创建了更多玩家， 也只需这么两个服装对象就足够了。旨在减少应用程序中对象的数量，以节省内存和提高性能。该模式采用对象共享的方式，通过共享相同的对象实例来减少系统中相似对象的数量，从而降低内存消耗和提高性能。

实际上完整的享元模式，包含两部分, 可以被共享的部分，不可以被共享部分，两者组合起来才构成一个完整的整体，设计享元模式，严谨的讲需要针对可共享部分与不可共享两部分设计接口：

- 单纯享元模式：在单纯享元模式中，所有的具体享元类都是可以共享的，不存在非共享具体享元类；
- 复合享元模式：将一些单纯享元对象使用组合模式加以组合，还可以形成复合享元对象，这样的复合享元对象本身不能共享，但是它们可以分解成单纯享元对象，而后者则可以共享。

在享元模式中， 我们会将享元对象存储在 map 容器中。 每当创建共享享元对象的其他对象时， 都会从 map 容器中获取享元对象。享元模式解决的问题就是重复创建对象占用内存的问题，将某个对象在多个对象之间复用。

下面让我们来看看此类安排的内部状态和外部状态：

- 内部状态： 内部状态的服装可在多个恐怖分子和反恐精英对象间共享；
- 外部状态： 玩家位置和玩家所使用的武器就是外部状态， 因为其在每个对象中都是不同的。

在 Go 语言中，享元模式通常通过工厂方法创建享元对象，并以某种方式共享这些对象实例。
